(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{468:function(e,t,n){"use strict";n.r(t);var o=n(0),a=Object(o.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"pruning-geth"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pruning-geth"}},[e._v("#")]),e._v(" Pruning Geth")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),t("p",[e._v("This is meant for "),t("code",[e._v("geth")]),e._v(" users only.\nNethermind and Besu do "),t("em",[e._v("not")]),e._v(" need to be manually pruned.")])]),e._v(" "),t("p",[e._v("If you use "),t("code",[e._v("geth")]),e._v(" as your primary Execution (ETH1) client, you will likely notice that your node's free disk space slowly decreases over time.\nGeth is by far the biggest contributor to this; depending on how much RAM you allocated to its cache during "),t("code",[e._v("rocketpool service config")]),e._v(", it can grow at a rate of several gigabytes per day!")]),e._v(" "),t("p",[e._v("To handle this, Geth provides a special function called "),t("strong",[e._v("pruning")]),e._v(" that lets it scan and clean up its database safely to reclaim some free space.\nEvery node operator using Geth will have to prune it eventually.")]),e._v(" "),t("p",[e._v("If you have a 2 TB SSD, you can usually go for months between rounds of pruning.\nFor 1 TB SSD users, you will have to prune more frequently.")]),e._v(" "),t("p",[e._v("If you have "),t("RouterLink",{attrs:{to:"/guides/node/grafana.html"}},[e._v("the Grafana dashboard")]),e._v(" enabled, a good rule of thumb is to start thinking about pruning Geth when your node's used disk space exceeds 80%.")],1),e._v(" "),t("p",[e._v("When you decide that it's time, the Smartnode comes with the ability to prune Geth for you upon request.\nRead below to learn how it works, and what to expect.")]),e._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),t("p",[e._v("When using the Smartnode to prune Geth, it's assumed that Geth is your "),t("strong",[e._v("primary")]),e._v(" Execution (ETH1) client and is managed by Rocket Pool (e.g. you chose Geth as your Execution (ETH1) client in "),t("code",[e._v("rocketpool service config")]),e._v(", and you're using Docker mode or Hybrid mode).")]),e._v(" "),t("p",[e._v("If you use your own Execution (ETH1) client, such as an external client in Hybrid mode or Native mode, you cannot use the Smartnode to prune Geth.\nYou will need to do it manually.")])]),e._v(" "),t("h2",{attrs:{id:"prerequisites"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),t("p",[e._v("Pruning Geth means taking the primary Execution (ETH1) client offline so it can clean itself up.\nWhen this happens, the Smartnode (and your Consensus (ETH2) client) will need some other way to access the ETH1 chain in order to function properly.")]),e._v(" "),t("p",[e._v("The easiest way to provide this is with a "),t("strong",[e._v("fallback ETH1 client")]),e._v(".\nIf you "),t("RouterLink",{attrs:{to:"/guides/node/docker.html#eth1-fallback-configuration"}},[e._v("configured an Execution (ETH1) fallback client")]),e._v(" using "),t("code",[e._v("rocketpool service config")]),e._v(" already, then the Smartnode will automatically switch over to it when your Geth contianer goes down for maintenance for you.\nIt will also inform your Consensus (ETH2) client to use the fallback as well.")],1),e._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),t("p",[e._v("If you don't have an Execution (ETH1) fallback client configured, your Smartnode will stop working until Geth finishes pruning.\nYour Consensus (ETH2) client will still attest, but it will fail any block proposals it makes.")])]),e._v(" "),t("p",[e._v("With that in mind, the following two conditions are required to successfully prune Geth:")]),e._v(" "),t("ul",[t("li",[e._v("A working Execution (ETH1) fallback client configured")]),e._v(" "),t("li",[e._v("At least "),t("strong",[e._v("50 GB")]),e._v(" of free space remaining on your SSD")])]),e._v(" "),t("h2",{attrs:{id:"starting-a-prune"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#starting-a-prune"}},[e._v("#")]),e._v(" Starting a Prune")]),e._v(" "),t("p",[e._v("When you want to prune Geth, simply run this command:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("rocketpool service prune-eth1\n")])])]),t("p",[e._v("This will present you something similar to the following message, depending on which ETH1 fallback client you're using:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("This will shut down your main ETH1 client and prune its database, freeing up disk space.\nOnce pruning is complete, your ETH1 client will restart automatically.\n\nYou have a fallback ETH1 client configured (custom). Rocket Pool (and your ETH2 client) will use that while the main client is pruning.\n")])])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),t("p",[e._v("If you're using Infura, you will see this warning message:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("If you are using Infura's free tier, you may hit its rate limit if pruning takes a long time.\nIf this happens, you should temporarily disable the `rocketpool_node` container until pruning is complete. This will:\n\t- Stop collecting Rocket Pool's network metrics in the Grafana dashboard\n\t- Stop automatic operations (claiming RPL rewards and staking new minipools)\n\nTo disable the container, run: `docker stop rocketpool_node`\nTo re-enable the container one pruning is complete, run: `docker start rocketpool_node`\n")])])]),t("p",[e._v("This warning is to let you know that Infura's free tier may not be enough to reliably act as a fallback for everything Rocket Pool needs while Geth prunes.\nThe Smartnode carries out quite a few queries to the Execution (ETH1) client (which scales linearly with the number of minipools you have running).")]),e._v(" "),t("p",[e._v("If you ever notice that the Smartnode or Grafana dashboard stop working properly, take a look at the fallback client's logs with:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("rocketpool service logs eth1-fallback\n")])])]),t("p",[e._v("If you see many messages about rate limits being hit or exceeded, then you will likely need to stop your node container as the warning text suggests so that the Smartnode isn't trying to query Infura so much.")])]),e._v(" "),t("p",[e._v("After this, you will be prompted to confirm that you're ready to prune.\nIf you accept, you'll see a few details as the Smartnode prepares things; it should end with a success message:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Are you sure you want to prune your main ETH1 client? [y/n]\ny\n\nYour disk has 303 GiB free, which is enough to prune.\nStopping rocketpool_eth1...\nProvisioning pruning on volume rocketpool_eth1clientdata...\nRestarting rocketpool_eth1...\n\nDone! Your main ETH1 client is now pruning. You can follow its progress with `rocketpool service logs eth1`.\nOnce it's done, it will restart automatically and resume normal operation.\nNOTE: While pruning, you **cannot** interrupt the client (e.g. by restarting) or you risk corrupting the database!\nYou must let it run to completion!\n")])])]),t("p",[e._v("With that, Geth is now pruning and you're all set!\nYou can follow its progress with:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("rocketpool service logs eth1\n")])])]),t("p",[e._v("Once it's done pruning, it will restart automatically and the Smartnode will resume using it again instead of your fallback.")])])}),[],!1,null,null,null);t.default=a.exports}}]);